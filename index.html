<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Tracker</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#21808D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1554/1554561.png">

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);

            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;

            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);

            --color-success-rgb: 33, 128, 141;
            --color-error-rgb: 192, 21, 47;

            --radius-base: 8px;
            --radius-lg: 12px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(167, 169, 169, 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-secondary: rgba(119, 124, 124, 0.15);
                --color-secondary-hover: rgba(119, 124, 124, 0.25);
                --color-border: rgba(119, 124, 124, 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-warning: var(--color-orange-400);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(119, 124, 124, 0.2);
            }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: var(--color-background); color: var(--color-text); padding: var(--space-20); line-height: 1.5; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { font-size: 28px; margin-bottom: var(--space-24); color: var(--color-text); }
        .tabs { display: flex; gap: var(--space-8); margin-bottom: var(--space-24); border-bottom: 1px solid var(--color-border); }
        .tab { padding: var(--space-12) var(--space-20); background: none; border: none; cursor: pointer; color: var(--color-text-secondary); font-size: 15px; font-weight: 500; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab.active { color: var(--color-primary); border-bottom-color: var(--color-primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: var(--color-surface); border: 1px solid var(--color-card-border); border-radius: var(--radius-lg); padding: var(--space-20); margin-bottom: var(--space-20); box-shadow: var(--shadow-sm); }
        .form-group { margin-bottom: var(--space-16); }
        label { display: block; margin-bottom: var(--space-8); font-weight: 500; font-size: 14px; color: var(--color-text); }
        input, select { width: 100%; padding: var(--space-12); border: 1px solid var(--color-border); border-radius: var(--radius-base); background: var(--color-surface); color: var(--color-text); font-size: 14px; }
        button { padding: var(--space-12) var(--space-24); background: var(--color-primary); color: var(--color-btn-primary-text); border: none; border-radius: var(--radius-base); cursor: pointer; font-size: 14px; font-weight: 500; }
        button:hover { background: var(--color-primary-hover); }
        table { width: 100%; border-collapse: collapse; margin-top: var(--space-16); }
        th, td { padding: var(--space-12); text-align: left; border-bottom: 1px solid var(--color-border); }
        th { font-weight: 600; background: var(--color-secondary); }
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .status-above { background: rgba(33, 128, 141, 0.15); color: var(--color-success); border: 1px solid rgba(33, 128, 141, 0.25); }
        .status-below { background: rgba(192, 21, 47, 0.15); color: var(--color-error); border: 1px solid rgba(192, 21, 47, 0.25); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-16); margin-bottom: var(--space-20); }
        .stat-card { background: var(--color-surface); border: 1px solid var(--color-card-border); border-radius: var(--radius-lg); padding: var(--space-20); box-shadow: var(--shadow-sm); }
        .stat-label { font-size: 13px; color: var(--color-text-secondary); margin-bottom: var(--space-8); }
        .stat-value { font-size: 28px; font-weight: 600; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-16); }
        @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } }
        .delete-btn { background: var(--color-error); color: white; padding: 6px 12px; font-size: 13px; }
    </style>
</head>
<body>
<div class="container">
    <h1>ðŸ“Š Production Tracker</h1>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
        <button class="tab" onclick="switchTab('products')">Products</button>
        <button class="tab" onclick="switchTab('daily')">Daily Entry</button>
        <button class="tab" onclick="switchTab('reports')">Monthly Report</button>
    </div>

    <div id="dashboard" class="tab-content active">
        <div class="grid">
            <div class="stat-card"><div class="stat-label">Total Workers</div><div class="stat-value" id="totalWorkers">0</div></div>
            <div class="stat-card"><div class="stat-label">Products Tracked</div><div class="stat-value" id="totalProducts">0</div></div>
            <div class="stat-card"><div class="stat-label">Today's Production</div><div class="stat-value" id="todayProduction">0</div></div>
            <div class="stat-card"><div class="stat-label">Today's Target</div><div class="stat-value" id="todayTarget">0</div></div>
        </div>
        <div class="card"><h2>Today's Performance</h2><div id="todayPerformance"></div></div>
    </div>

    <div id="products" class="tab-content">
        <div class="card">
            <h2>Add New Product</h2>
            <form id="productForm">
                <div class="form-row">
                    <div class="form-group"><label>Product Name</label><input type="text" id="productName" required></div>
                    <div class="form-group"><label>Daily Target</label><input type="number" id="dailyTarget" min="1" required></div>
                </div>
                <button type="submit">Add Product</button>
            </form>
        </div>
        <div class="card"><h2>Product List</h2><div id="productList"></div></div>
    </div>

    <div id="daily" class="tab-content">
        <div class="card">
            <h2>Record Daily Production</h2>
            <form id="productionForm">
                <div class="form-row">
                    <div class="form-group"><label>Date</label><input type="date" id="entryDate" required></div>
                    <div class="form-group"><label>Worker Name</label><input type="text" id="workerName" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Product</label><select id="productSelect" required><option value="">Select Product</option></select></div>
                    <div class="form-group"><label>Pieces Produced</label><input type="number" id="piecesProduced" min="0" required></div>
                </div>
                <button type="submit">Record Production</button>
            </form>
        </div>
        <div class="card"><h2>Recent Entries</h2><div id="recentEntries"></div></div>
    </div>

    <div id="reports" class="tab-content">
        <div class="card">
            <h2>Monthly Report</h2>
            <input type="month" id="reportMonth">
            <button onclick="generateReport()">Generate Report</button>
            <div id="monthlyReport"></div>
        </div>
    </div>
</div>

<script>
    // FIREBASE CONFIGURATION
    const firebaseConfig = {
      apiKey: "AIzaSyDLpRcgtN0Ts2yUMh-X1CCKy1uDtqncQFU",
      authDomain: "production-tracker-70dca.firebaseapp.com",
      projectId: "production-tracker-70dca",
      storageBucket: "production-tracker-70dca.firebasestorage.app",
      messagingSenderId: "884902656220",
      appId: "1:884902656220:web:d01252f1f222db215f1c19",
      measurementId: "G-Q0B6EH3ZET"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let products = [];
    let productionEntries = [];

    async function init() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.log(err));
        }
        await loadData();
        document.getElementById('entryDate').valueAsDate = new Date();
    }

    // MULTIUSER CLOUD SYNC
    async function saveData() {
        const data = { products, entries: productionEntries, lastUpdated: new Date() };
        try {
            await db.collection("factoryData").doc("mainTracker").set(data);
            console.log("Synced to cloud!");
        } catch (e) { console.error("Sync error:", e); }
    }

    async function loadData() {
        try {
            const doc = await db.collection("factoryData").doc("mainTracker").get();
            if (doc.exists) {
                const data = doc.data();
                products = data.products || [];
                productionEntries = data.entries || [];
                updateUI();
            }
        } catch (e) { console.error("Load error:", e); }
    }

    function updateUI() {
        updateDashboard();
        updateProductList();
        updateProductSelect();
        updateRecentEntries();
    }

    // Tab Logic
    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        if (tabName === 'dashboard') updateDashboard();
    }

    // Product Logic
    document.getElementById('productForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        products.push({ id: Date.now(), name: document.getElementById('productName').value, dailyTarget: parseInt(document.getElementById('dailyTarget').value) });
        await saveData();
        updateUI();
        e.target.reset();
    });

    function updateProductList() {
        let html = '<table><tr><th>Name</th><th>Target</th><th>Action</th></tr>';
        products.forEach(p => {
            html += `<tr><td>${p.name}</td><td>${p.dailyTarget}</td><td><button class="delete-btn" onclick="deleteProduct(${p.id})">Delete</button></td></tr>`;
        });
        document.getElementById('productList').innerHTML = html + '</table>';
    }

    async function deleteProduct(id) {
        products = products.filter(p => p.id !== id);
        await saveData();
        updateUI();
    }

    function updateProductSelect() {
        const select = document.getElementById('productSelect');
        select.innerHTML = '<option value="">Select Product</option>';
        products.forEach(p => select.innerHTML += `<option value="${p.id}">${p.name}</option>`);
    }

    // Production Logic
    document.getElementById('productionForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const pId = parseInt(document.getElementById('productSelect').value);
        const product = products.find(p => p.id === pId);
        productionEntries.push({
            date: document.getElementById('entryDate').value,
            worker: document.getElementById('workerName').value,
            productName: product.name,
            target: product.dailyTarget,
            produced: parseInt(document.getElementById('piecesProduced').value)
        });
        await saveData();
        updateUI();
        e.target.reset();
        document.getElementById('entryDate').valueAsDate = new Date();
    });

    function updateRecentEntries() {
        let html = '<table><tr><th>Date</th><th>Worker</th><th>Product</th><th>Produced</th></tr>';
        [...productionEntries].reverse().slice(0, 5).forEach(e => {
            html += `<tr><td>${e.date}</td><td>${e.worker}</td><td>${e.productName}</td><td>${e.produced}</td></tr>`;
        });
        document.getElementById('recentEntries').innerHTML = html + '</table>';
    }

    function updateDashboard() {
        const today = new Date().toISOString().split('T')[0];
        const todayEntries = productionEntries.filter(e => e.date === today);
        document.getElementById('totalWorkers').innerText = [...new Set(productionEntries.map(e => e.worker))].length;
        document.getElementById('totalProducts').innerText = products.length;
        document.getElementById('todayProduction').innerText = todayEntries.reduce((s, e) => s + e.produced, 0);
        document.getElementById('todayTarget').innerText = todayEntries.reduce((s, e) => s + e.target, 0);
    }

    init();
</script>
</body>
</html>
